{% extends 'base.html.twig' %}

{% block title %} 

    {% if faq.titre is defined and faq.titre is not null %}
        {{faq.titre}}
    {% else %}
        
    {% endif %}
    
{% endblock %}

{% block body %}
    {% for label, messages in app.flashes(['success', 'warning', 'danger']) %}
    {% for message in messages %}
        <div class="alert alert-{{ label }} alert-dismissible fade show mt-3" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
    {% endfor %}
    
    
            <div class="container">
            
                <h1>
                    {{ faq.titre }}
                </h1>

                <p style="font-size:10px"> {{faq.commentaires|length}} réponse</p>

                <p>
                    {{ faq.question }}
                </p>
            </div>
            <div style="height:100px"></div>
            <div class="container">
                <div class="col-xs-2 col-sm-3 gutter-0">
                    <h2> Les {{ faq.commentaires|length}} réponses à la quéstion posée</h2>
                    {% for commentaire in faq.commentaires %}
                        {% if commentaire.parent == null  %}
                            <h3>Question de {{commentaire.user.pseudo}}</h3>
                            <p>Publié par {{commentaire.user.pseudo}} le {{commentaire.createdAt|date("d/m/Y H:i")}}</p>
                            <div>{{commentaire.contenuscommentaire|raw}}</div>
                            <p><a href="#ajout-commentaire" data-reply data-id="{{commentaire.id}}" class="btn btn-secondary press">Répondre</a></p>
                            
                            {# on affiche les reponses #}
                            {% for reply in commentaire.reponse %}
                                <p>Réponse publiée par {{reply.user.pseudo}} le {{reply.createdAt|date("d/m/Y H:i")}}</p>
                                <div>{{reply.contenuscommentaire|raw}}</div>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                </div>
                <div style="height:100px"></div>
                <div class="col-xs2 col-sm3" id="ajout-commentaire">
                    <h3> Ajouter une réponse</h3>
                    <div>
                        <p>pseudo : {{ app.user.pseudo}}</p>
                    </div>
                    {{ form(form) }}
                </div>
            </div>
{% endblock %}

{% block javascript %}
    <script>
        window.onload = () => {
            // on met un écouteur d'événements sur tout les bouttons répondres
            document.querySelectorAll("[data-reply]").forEach(element => {
                element.addEventListener("click", function(){
                    document.querySelector("#commentaires_parent").value = this.dataset.id;
                });
            });
        }

        //on verifie si il y a des objets de la classe alert dans el dom de la page à l'aide du 
    //sélecteur jQuery $("") qui comme on sélectionne une classe nous renvoie un tableau
    //dont on verifie que la longeur est >0
    if($(".alert").length>0){
        //on crée une pause avec setTimeout qui déclenchera une fonction anonyme aprés 2 seconde
        setTimeout(function(){
            //On déclanche la disparition en fondu (animation de style css ) des alerts
            //Lorsque le fondu est effectué on supprime les alerts du dom avec remove();
            $(".alert").fadeOut(500, function(){ $(".alert").remove() });
        }, 2000);
    }
    </script>

{% endblock %}